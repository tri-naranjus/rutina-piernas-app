<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de Entrenamiento de Piernas</title>
  <!-- Tailwind CSS via CDN for rapid styling -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-green-200 via-blue-200 to-purple-200 min-h-screen flex justify-center p-4">
  <div id="app" class="w-full max-w-5xl"></div>

  <script>
    // Datos de plan de entrenamiento: fases, d√≠as y ejercicios
    const plan = {
      'Fase 1 ‚Äì Adaptaci√≥n': {
        'D√≠a 1': [
          { name: 'Sentadilla trasera/Smith', setsReps: '3 √ó 6‚Äì8', instructions: 'Carga al 60‚Äì70¬†% 1RM. Mantener la velocidad >¬†0,5¬†m/s y la profundidad controlada.', emoji: 'üèãÔ∏è' },
          { name: 'Peso muerto rumano', setsReps: '3 √ó 6‚Äì8', instructions: '√ânfasis en isquiotibiales y gl√∫teos. Espalda neutra y movimiento explosivo.', emoji: 'ü¶µ' },
          { name: 'Zancadas caminando', setsReps: '2 √ó 8 por pierna', instructions: 'Utilizar mancuernas ligeras. Subir r√°pido (>¬†0,8¬†m/s) y descender controlado.', emoji: 'üö∂' },
          { name: 'Elevaciones de tal√≥n (gemelos)', setsReps: '3 √ó 10‚Äì12', instructions: 'Carga moderada; foco en la explosividad del ascenso.', emoji: 'üêê' }
        ],
        'D√≠a 2': [
          { name: 'Sentadilla frontal (barra o kettlebell)', setsReps: '3 √ó 6‚Äì8', instructions: 'Carga al 60‚Äì70¬†%. Mantener el torso erguido y velocidad >¬†0,5¬†m/s.', emoji: 'üèãÔ∏è' },
          { name: 'Prensa de pierna unipodal', setsReps: '3 √ó 6‚Äì8 por pierna', instructions: 'Imitar el estudio de Vikmoen: prensa con una pierna. Monitorizar velocidad para evitar empujar lentamente.', emoji: 'ü¶ø' },
          { name: 'Step‚Äëup sobre caja con rodilla alta', setsReps: '2 √ó 8 por pierna', instructions: 'Cargar con barra ligera o mancuerna. Subir r√°pidamente (1,0‚Äì1,2¬†m/s) y descender controlado.', emoji: 'üì¶' },
          { name: 'Flexi√≥n de cadera con cinta/el√°stico', setsReps: '2 √ó 10 por pierna', instructions: 'Ejercicio de flexores de cadera. Ejecutar con alta velocidad para mejorar la acci√≥n de subida de rodilla.', emoji: 'üßò' }
        ]
      },
      'Fase 2 ‚Äì Fuerza m√°xima': {
        'D√≠a 1': [
          { name: 'Media sentadilla en m√°quina Smith', setsReps: '4 √ó 4‚Äì6', instructions: 'Aumentar progresivamente de 75¬†% a 85‚Äì90¬†% 1RM. Monitorizar que la velocidad no baje de 0,3¬†m/s.', emoji: 'üèãÔ∏è' },
          { name: 'Prensa de pierna unipodal', setsReps: '3 √ó 4‚Äì6', instructions: 'Carga pesada. Mantener la espalda pegada al respaldo. Velocidad de 0,3‚Äì0,5¬†m/s.', emoji: 'ü¶ø' },
          { name: 'Peso muerto rumano o hip thrust', setsReps: '3 √ó 4‚Äì6', instructions: 'Alternar entre peso muerto rumano y hip thrust. Mantener la velocidad adecuada.', emoji: 'üçë' },
          { name: 'Elevaci√≥n de tal√≥n sentado', setsReps: '3 √ó 8', instructions: 'Carga pesada para fortalecer gemelos. Velocidad moderada.', emoji: 'üêê' }
        ],
        'D√≠a 2': [
          { name: 'Sentadilla trasera + salto (complex)', setsReps: '3 superseries', instructions: 'Realizar serie pesada (3‚Äì4 repeticiones al 85¬†% 1RM) seguida de 3‚Äì5 saltos con carga ligera (20‚Äì30¬†% 1RM).', emoji: 'üîÅ' },
          { name: 'Peso muerto rumano', setsReps: '3 √ó 5', instructions: 'Mantener la misma progresi√≥n de carga que en D√≠a¬†1.', emoji: 'üçë' },
          { name: 'Step‚Äëup lateral pesado', setsReps: '3 √ó 4‚Äì6 por pierna', instructions: 'Emplear banco m√°s alto y barra sobre los hombros. Velocidad 0,4‚Äì0,5¬†m/s.', emoji: 'üì¶' },
          { name: 'Flexi√≥n de cadera con resistencia', setsReps: '2 √ó 8‚Äì10 por pierna', instructions: 'Aumentar tensi√≥n del el√°stico. Ejecutar con velocidad alta (>¬†1¬†m/s).', emoji: 'üßò' }
        ]
      },
      'Fase 3 ‚Äì Potencia y velocidad': {
        'D√≠a 1': [
          { name: 'Sentadilla jump con carga', setsReps: '4 √ó 4‚Äì6', instructions: 'Utilizar 20‚Äì40¬†% 1RM. Monitorear que la velocidad pico supere 1,0¬†m/s. Aterrizar suave.', emoji: 'üöÄ' },
          { name: 'Peso muerto con trap bar de alta velocidad', setsReps: '3 √ó 4‚Äì5', instructions: 'Trabajar con 50‚Äì60¬†% 1RM a velocidades de 0,8‚Äì1,0¬†m/s.', emoji: 'üîó' },
          { name: 'Desplantes pliom√©tricos', setsReps: '3 √ó 6 por pierna', instructions: 'Saltar de zancada a zancada con mancuernas ligeras o solo peso corporal.', emoji: 'ü¶ò' },
          { name: 'Sprint en cinta inclinada o pedaleo de alta cadencia', setsReps: '3 √ó 30¬†s', instructions: 'Realizar sprints inmediatamente despu√©s de los ejercicios para transferir la potencia a la carrera o al pedaleo.', emoji: 'üö¥' }
        ],
        'D√≠a 2': [
          { name: 'Sentadilla b√∫lgara con salto', setsReps: '3 √ó 5 por pierna', instructions: 'Cargar con mancuerna ligera (10‚Äì20¬†% 1RM). Realizar salto explosivo manteniendo equilibrio.', emoji: 'ü§∏' },
          { name: 'Hip thrust explosivo', setsReps: '3 √ó 6', instructions: 'Utilizar banda el√°stica o peso moderado. Elevar la cadera r√°pidamente con velocidad >¬†1¬†m/s.', emoji: 'üçë' },
          { name: 'Step‚Äëup r√°pido con barra ligera', setsReps: '3 √ó 6‚Äì8 por pierna', instructions: 'Enfocarse en velocidad y coordinaci√≥n; medir con el encoder para mantener 1‚Äì1,3¬†m/s.', emoji: 'üì¶' },
          { name: 'Saltos en caj√≥n o bounds', setsReps: '2 √ó 6‚Äì8', instructions: 'Pliometr√≠a pura para mejorar la elasticidad tendinosa y la capacidad de producir fuerza r√°pidamente.', emoji: 'üì•' }
        ]
      }
    };

    // Utilidades para c√°lculo de repeticiones medias y predicci√≥n de 1RM
    function parseAvgRep(setsReps) {
      const match = setsReps.match(/\d+\s*[√óxX]\s*(\d+)(?:[‚Äì-](\d+))?/);
      if (!match) return 0;
      const minRep = parseInt(match[1], 10);
      const maxRep = match[2] ? parseInt(match[2], 10) : minRep;
      return (minRep + maxRep) / 2;
    }

    function predict1RM(weight, avgRep) {
      if (!weight || !avgRep) return null;
      const est = weight / (1 - avgRep * 0.025);
      return Math.round(est * 10) / 10;
    }

    // Gesti√≥n de logs en localStorage
    function loadLogs() {
      const raw = localStorage.getItem('legLogs');
      return raw ? JSON.parse(raw) : [];
    }
    function saveLogs(logs) {
      localStorage.setItem('legLogs', JSON.stringify(logs));
    }
    function getLastWeight(logs, exerciseName) {
      for (let i = logs.length - 1; i >= 0; i--) {
        const session = logs[i];
        if (session.exercises && session.exercises[exerciseName]) {
          return session.exercises[exerciseName];
        }
      }
      return null;
    }
    function getSuggestion(logs, exerciseName) {
      const last = getLastWeight(logs, exerciseName);
      if (!last) return '';
      return Math.round(last * 1.05 * 10) / 10;
    }

    // Estado de la aplicaci√≥n
    let logs = loadLogs();
    let selectedPhase = Object.keys(plan)[0];
    let selectedDay = Object.keys(plan[selectedPhase])[0];
    let sessionDate = new Date().toISOString().slice(0, 10);
    let currentWeights = {};

    function render() {
      const app = document.getElementById('app');
      app.innerHTML = '';

      // T√≠tulo
      const title = document.createElement('h1');
      title.className = 'text-2xl font-bold mb-4 text-gray-800';
      title.textContent = 'Registro de Entrenamiento de Piernas';
      app.appendChild(title);

      // Contenedor de selectores
      const selectors = document.createElement('div');
      selectors.className = 'grid grid-cols-1 md:grid-cols-3 gap-4 mb-4';

      // Selector de fase
      const phaseDiv = document.createElement('div');
      phaseDiv.className = 'flex flex-col';
      const phaseLabel = document.createElement('label');
      phaseLabel.className = 'font-semibold mb-1 text-gray-700';
      phaseLabel.textContent = 'Fase';
      const phaseSelect = document.createElement('select');
      phaseSelect.className = 'p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500';
      Object.keys(plan).forEach(phase => {
        const opt = document.createElement('option');
        opt.value = phase;
        opt.textContent = phase;
        if (phase === selectedPhase) opt.selected = true;
        phaseSelect.appendChild(opt);
      });
      phaseSelect.addEventListener('change', e => {
        selectedPhase = e.target.value;
        selectedDay = Object.keys(plan[selectedPhase])[0];
        currentWeights = {};
        render();
      });
      phaseDiv.appendChild(phaseLabel);
      phaseDiv.appendChild(phaseSelect);
      selectors.appendChild(phaseDiv);

      // Selector de d√≠a
      const dayDiv = document.createElement('div');
      dayDiv.className = 'flex flex-col';
      const dayLabel = document.createElement('label');
      dayLabel.className = 'font-semibold mb-1 text-gray-700';
      dayLabel.textContent = 'D√≠a';
      const daySelect = document.createElement('select');
      daySelect.className = 'p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500';
      Object.keys(plan[selectedPhase]).forEach(day => {
        const opt = document.createElement('option');
        opt.value = day;
        opt.textContent = day;
        if (day === selectedDay) opt.selected = true;
        daySelect.appendChild(opt);
      });
      daySelect.addEventListener('change', e => {
        selectedDay = e.target.value;
        currentWeights = {};
        render();
      });
      dayDiv.appendChild(dayLabel);
      dayDiv.appendChild(daySelect);
      selectors.appendChild(dayDiv);

      // Selector de fecha
      const dateDiv = document.createElement('div');
      dateDiv.className = 'flex flex-col';
      const dateLabel = document.createElement('label');
      dateLabel.className = 'font-semibold mb-1 text-gray-700';
      dateLabel.textContent = 'Fecha de la sesi√≥n';
      const dateInput = document.createElement('input');
      dateInput.type = 'date';
      dateInput.className = 'p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500';
      dateInput.value = sessionDate;
      dateInput.addEventListener('change', e => {
        sessionDate = e.target.value;
      });
      dateDiv.appendChild(dateLabel);
      dateDiv.appendChild(dateInput);
      selectors.appendChild(dateDiv);

      app.appendChild(selectors);

      // Tabla de ejercicios
      const tableDiv = document.createElement('div');
      tableDiv.className = 'overflow-x-auto mb-4';
      const table = document.createElement('table');
      table.className = 'min-w-full text-sm divide-y divide-gray-200';
      const thead = document.createElement('thead');
      thead.className = 'bg-gray-100 text-gray-700';
      thead.innerHTML = `<tr>
        <th class="py-2 px-2">Ejercicio</th>
        <th class="py-2 px-2">Series √ó rep.</th>
        <th class="py-2 px-2">Indicaciones</th>
        <th class="py-2 px-2">√öltimo peso (kg)</th>
        <th class="py-2 px-2">1RM estimado (kg)</th>
        <th class="py-2 px-2">Introduce tu peso (kg)</th>
      </tr>`;
      const tbody = document.createElement('tbody');
      tbody.className = 'bg-white divide-y divide-gray-200';

      // Genera filas para cada ejercicio
      function populateTable() {
        tbody.innerHTML = '';
        const exercises = plan[selectedPhase][selectedDay];
        exercises.forEach(ex => {
          const tr = document.createElement('tr');
          tr.className = 'hover:bg-blue-50';
          // Nombre y emoji
          const tdName = document.createElement('td');
          tdName.className = 'py-2 px-2 whitespace-nowrap font-medium flex items-center space-x-2';
          const spanEmoji = document.createElement('span');
          spanEmoji.className = 'text-xl';
          spanEmoji.textContent = ex.emoji;
          const spanName = document.createElement('span');
          spanName.textContent = ex.name;
          tdName.appendChild(spanEmoji);
          tdName.appendChild(spanName);
          // Series x rep
          const tdSets = document.createElement('td');
          tdSets.className = 'py-2 px-2 whitespace-nowrap';
          tdSets.textContent = ex.setsReps;
          // Indicaciones
          const tdInstr = document.createElement('td');
          tdInstr.className = 'py-2 px-2';
          tdInstr.textContent = ex.instructions;
          // √öltimo peso
          const lastWeight = getLastWeight(logs, ex.name);
          const tdLast = document.createElement('td');
          tdLast.className = 'py-2 px-2 text-center';
          tdLast.textContent = lastWeight ?? '-';
          // 1RM estimado
          const avgRep = parseAvgRep(ex.setsReps);
          const last1RM = lastWeight ? predict1RM(lastWeight, avgRep) : null;
          const td1RM = document.createElement('td');
          td1RM.className = 'py-2 px-2 text-center';
          td1RM.textContent = last1RM ?? '-';
          // Input de peso
          const tdInput = document.createElement('td');
          tdInput.className = 'py-2 px-2';
          const divInput = document.createElement('div');
          divInput.className = 'flex items-center space-x-1';
          const input = document.createElement('input');
          input.type = 'number';
          input.min = '0';
          input.step = '0.5';
          input.className = 'w-24 p-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500';
          const suggestion = getSuggestion(logs, ex.name);
          input.placeholder = suggestion || '0';
          input.value = currentWeights[ex.name] || '';
          input.addEventListener('input', e => {
            const val = parseFloat(e.target.value);
            if (!isNaN(val)) currentWeights[ex.name] = val;
            else delete currentWeights[ex.name];
          });
          divInput.appendChild(input);
          if (suggestion) {
            const spanSug = document.createElement('span');
            spanSug.className = 'text-xs text-gray-500';
            spanSug.textContent = `(sug: ${suggestion})`;
            divInput.appendChild(spanSug);
          }
          tdInput.appendChild(divInput);
          // A√±adir celdas a fila
          tr.appendChild(tdName);
          tr.appendChild(tdSets);
          tr.appendChild(tdInstr);
          tr.appendChild(tdLast);
          tr.appendChild(td1RM);
          tr.appendChild(tdInput);
          tbody.appendChild(tr);
        });
      }
      populateTable();
      table.appendChild(thead);
      table.appendChild(tbody);
      tableDiv.appendChild(table);
      app.appendChild(tableDiv);

      // Bot√≥n de guardar sesi√≥n
      const saveBtn = document.createElement('button');
      saveBtn.className = 'bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors';
      saveBtn.textContent = 'Guardar sesi√≥n';
      saveBtn.addEventListener('click', () => {
        if (!sessionDate) return;
        const newSession = {
          date: sessionDate,
          phase: selectedPhase,
          day: selectedDay,
          exercises: { ...currentWeights }
        };
        logs.push(newSession);
        saveLogs(logs);
        currentWeights = {};
        // Reiniciar tabla y mostrar notificaci√≥n
        populateTable();
        renderLogsSection();
        alert('Sesi√≥n guardada correctamente');
      });
      app.appendChild(saveBtn);

      // Secci√≥n de historial
      const historyDiv = document.createElement('div');
      historyDiv.className = 'mt-8';
      const histTitle = document.createElement('h2');
      histTitle.className = 'text-xl font-semibold mb-2 text-gray-800';
      histTitle.textContent = 'Historial de sesiones';
      historyDiv.appendChild(histTitle);
      const histContent = document.createElement('div');
      historyDiv.appendChild(histContent);
      app.appendChild(historyDiv);

      function renderLogsSection() {
        histContent.innerHTML = '';
        if (logs.length === 0) {
          const p = document.createElement('p');
          p.className = 'text-gray-600';
          p.textContent = 'No hay sesiones registradas.';
          histContent.appendChild(p);
        } else {
          const table = document.createElement('table');
          table.className = 'min-w-full text-sm divide-y divide-gray-200';
          const thead = document.createElement('thead');
          thead.className = 'bg-gray-100 text-gray-700';
          thead.innerHTML = `<tr>
            <th class="py-2 px-2">Fecha</th>
            <th class="py-2 px-2">Fase</th>
            <th class="py-2 px-2">D√≠a</th>
            <th class="py-2 px-2">Ejercicios y pesos</th>
          </tr>`;
          const tbody = document.createElement('tbody');
          tbody.className = 'bg-white divide-y divide-gray-200';
          logs.forEach(session => {
            const tr = document.createElement('tr');
            const tdDate = document.createElement('td'); tdDate.className = 'py-2 px-2 whitespace-nowrap'; tdDate.textContent = session.date;
            const tdPhase = document.createElement('td'); tdPhase.className = 'py-2 px-2 whitespace-nowrap'; tdPhase.textContent = session.phase;
            const tdDay = document.createElement('td'); tdDay.className = 'py-2 px-2 whitespace-nowrap'; tdDay.textContent = session.day;
            const tdEx = document.createElement('td'); tdEx.className = 'py-2 px-2';
            Object.entries(session.exercises).forEach(([exName, wt]) => {
              const div = document.createElement('div');
              div.className = 'flex items-center space-x-1';
              const spanName = document.createElement('span'); spanName.className = 'font-semibold'; spanName.textContent = exName + ':';
              const spanWt = document.createElement('span'); spanWt.textContent = wt || '-' + ' kg';
              div.appendChild(spanName);
              div.appendChild(spanWt);
              tdEx.appendChild(div);
            });
            tr.appendChild(tdDate);
            tr.appendChild(tdPhase);
            tr.appendChild(tdDay);
            tr.appendChild(tdEx);
            tbody.appendChild(tr);
          });
          table.appendChild(thead);
          table.appendChild(tbody);
          histContent.appendChild(table);
        }
      }
      renderLogsSection();
    }
    document.addEventListener('DOMContentLoaded', render);
  </script>
</body>
</html>